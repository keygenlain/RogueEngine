<Window x:Class="RogueEngine.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:RogueEngine.ViewModels"
        mc:Ignorable="d"
        Title="RogueEngine Editor"
        Height="900"
        Width="1500"
        MinHeight="700"
        MinWidth="1100"
        Loaded="Window_Loaded">
    <Window.DataContext>
        <vm:MainViewModel />
    </Window.DataContext>

    <DockPanel>
        <DockPanel DockPanel.Dock="Top" LastChildFill="True">
            <Menu DockPanel.Dock="Top">
                <MenuItem Header="_File">
                    <MenuItem Header="_New" />
                    <MenuItem Header="_Open" />
                    <MenuItem Header="_Save" Command="{Binding SaveCommand}" />
                    <Separator />
                    <MenuItem Header="E_xit" />
                </MenuItem>
                <MenuItem Header="_Edit">
                    <MenuItem Header="_Undo" />
                    <MenuItem Header="_Redo" />
                    <Separator />
                    <MenuItem Header="_Copy" />
                    <MenuItem Header="_Paste" />
                </MenuItem>
                <MenuItem Header="_Run">
                    <MenuItem Header="_Play" Command="{Binding PlayCommand}" />
                    <MenuItem Header="_Stop" />
                </MenuItem>
            </Menu>

            <ToolBarTray DockPanel.Dock="Top">
                <ToolBar>
                    <Button Content="Save" Command="{Binding SaveCommand}" />
                    <Button Content="Play" Command="{Binding PlayCommand}" />
                </ToolBar>
            </ToolBarTray>
        </DockPanel>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="5" />
                <RowDefinition Height="220" />
            </Grid.RowDefinitions>

            <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="260" MinWidth="180" />
                    <ColumnDefinition Width="5" />
                    <ColumnDefinition Width="*" MinWidth="420" />
                    <ColumnDefinition Width="5" />
                    <ColumnDefinition Width="320" MinWidth="220" />
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0" BorderBrush="#333" BorderThickness="0,0,1,0" Padding="8">
                    <DockPanel>
                        <TextBlock DockPanel.Dock="Top" Text="Project Hierarchy" FontWeight="SemiBold" Margin="0,0,0,8" />
                        <TreeView ItemsSource="{Binding ProjectHierarchy}">
                            <TreeView.Resources>
                                <HierarchicalDataTemplate DataType="{x:Type vm:HierarchyItem}" ItemsSource="{Binding Children}">
                                    <TextBlock Text="{Binding Name}" />
                                </HierarchicalDataTemplate>
                            </TreeView.Resources>
                        </TreeView>
                    </DockPanel>
                </Border>

                <GridSplitter Grid.Column="1"
                              Width="5"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Stretch"
                              ResizeDirection="Columns"
                              ResizeBehavior="PreviousAndNext"
                              Background="#444" />

                <Border Grid.Column="2" Padding="8">
                    <TabControl>
                        <TabItem Header="ASCII Viewport">
                            <Grid Margin="8" Background="#111">
                                <TextBlock Text="Main Game ASCII Viewport"
                                           Foreground="#DDD"
                                           FontFamily="Consolas"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center" />
                            </Grid>
                        </TabItem>
                        <TabItem Header="Visual Scripting Canvas">
                            <Grid Margin="8" Background="#1A1A1A">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="300" MinWidth="220" />
                                        <ColumnDefinition Width="5" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <Border Grid.Column="0" BorderBrush="#2A2A2A" BorderThickness="1" Background="#141414" Padding="10">
                                        <DockPanel>
                                            <TextBlock DockPanel.Dock="Top" Text="Node Browser" Foreground="#DDD" FontWeight="SemiBold" Margin="0,0,0,8" />

                                            <StackPanel DockPanel.Dock="Top" Margin="0,0,0,10">
                                                <TextBlock Text="Search" Foreground="#CCC" />
                                                <TextBox Margin="0,4,0,8"
                                                         Text="{Binding NodeSearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                                                <TextBlock Text="Category" Foreground="#CCC" />
                                                <ComboBox Margin="0,4,0,8"
                                                          ItemsSource="{Binding NodeCategories}"
                                                          SelectedItem="{Binding SelectedNodeCategory, Mode=TwoWay}" />

                                                <Button Content="Add Selected Node" Click="AddNodeButton_Click" />
                                            </StackPanel>

                                            <ListBox x:Name="NodeBrowserListBox"
                                                     ItemsSource="{Binding FilteredNodeDefinitions}"
                                                     SelectedItem="{Binding SelectedNodeDefinition, Mode=TwoWay}"
                                                     MouseDoubleClick="NodeBrowserListBox_MouseDoubleClick"
                                                     BorderThickness="1"
                                                     BorderBrush="#2F2F2F">
                                                <ListBox.ItemTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Margin="0,4,0,4">
                                                            <TextBlock Text="{Binding Title}" Foreground="#EDEDED" FontWeight="SemiBold" />
                                                            <TextBlock Text="{Binding Category}" Foreground="#88B0FF" FontSize="11" />
                                                            <TextBlock Text="{Binding Description}" Foreground="#B9B9B9" FontSize="11" TextWrapping="Wrap" />
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </ListBox.ItemTemplate>
                                            </ListBox>
                                        </DockPanel>
                                    </Border>

                                    <GridSplitter Grid.Column="1"
                                                  Width="5"
                                                  HorizontalAlignment="Stretch"
                                                  VerticalAlignment="Stretch"
                                                  ResizeDirection="Columns"
                                                  ResizeBehavior="PreviousAndNext"
                                                  Background="#444" />

                                    <DockPanel Grid.Column="2">
                                        <TextBlock DockPanel.Dock="Top"
                                                   Text="Drag nodes to move. Drag from right pin to left pin to connect."
                                                   Foreground="#DDD"
                                                   Margin="0,0,0,8" />

                                        <Border x:Name="GraphViewport" BorderBrush="#2A2A2A" BorderThickness="1" Background="#151515" ClipToBounds="True">
                                            <Grid x:Name="GraphSurface">
                                                <Canvas x:Name="ConnectionCanvas" IsHitTestVisible="False" />
                                                <Canvas x:Name="NodeCanvas"
                                                        Background="Transparent"
                                                        MouseDown="NodeCanvas_MouseDown"
                                                        MouseUp="NodeCanvas_MouseUp"
                                                        MouseMove="NodeCanvas_MouseMove"
                                                        MouseLeftButtonUp="NodeCanvas_MouseLeftButtonUp"
                                                        MouseWheel="NodeCanvas_MouseWheel" />
                                            </Grid>
                                        </Border>
                                    </DockPanel>
                                </Grid>
                            </Grid>
                        </TabItem>
                    </TabControl>
                </Border>

                <GridSplitter Grid.Column="3"
                              Width="5"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Stretch"
                              ResizeDirection="Columns"
                              ResizeBehavior="PreviousAndNext"
                              Background="#444" />

                <Border Grid.Column="4" BorderBrush="#333" BorderThickness="1,0,0,0" Padding="8">
                    <DockPanel>
                        <TextBlock DockPanel.Dock="Top" Text="Properties" FontWeight="SemiBold" Margin="0,0,0,8" />
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel>
                                <TextBlock Text="Selected Item" FontWeight="SemiBold" />
                                <TextBox Text="{Binding SelectedItemName, UpdateSourceTrigger=PropertyChanged}" Margin="0,4,0,10" />

                                <TextBlock Text="ASCII Character" />
                                <TextBox Text="{Binding SelectedGlyph, UpdateSourceTrigger=PropertyChanged}" Margin="0,4,0,10" />

                                <TextBlock Text="Foreground Color" />
                                <TextBox Text="{Binding ForegroundColor, UpdateSourceTrigger=PropertyChanged}" Margin="0,4,0,10" />

                                <TextBlock Text="Background Color" />
                                <TextBox Text="{Binding BackgroundColor, UpdateSourceTrigger=PropertyChanged}" Margin="0,4,0,10" />

                                <TextBlock Text="Node Type" />
                                <TextBox Text="{Binding SelectedNodeType, UpdateSourceTrigger=PropertyChanged}" Margin="0,4,0,10" />

                                <TextBlock Text="Custom Font Path / URL" />
                                <TextBox Text="{Binding CustomFontPath, UpdateSourceTrigger=PropertyChanged}" Margin="0,4,0,10" />

                                <TextBlock Text="Position X" />
                                <TextBox Text="{Binding NodeX, UpdateSourceTrigger=PropertyChanged}" Margin="0,4,0,10" />

                                <TextBlock Text="Position Y" />
                                <TextBox Text="{Binding NodeY, UpdateSourceTrigger=PropertyChanged}" Margin="0,4,0,0" />
                            </StackPanel>
                        </ScrollViewer>
                    </DockPanel>
                </Border>
            </Grid>

            <GridSplitter Grid.Row="1"
                          Height="5"
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Stretch"
                          ResizeDirection="Rows"
                          ResizeBehavior="PreviousAndNext"
                          Background="#444" />

            <Grid Grid.Row="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <StatusBar Grid.Row="0">
                    <StatusBarItem>
                        <TextBlock Text="Coordinates:" />
                    </StatusBarItem>
                    <StatusBarItem>
                        <TextBlock Text="X:" />
                    </StatusBarItem>
                    <StatusBarItem>
                        <TextBlock Text="{Binding CursorX}" />
                    </StatusBarItem>
                    <StatusBarItem>
                        <TextBlock Text="Y:" />
                    </StatusBarItem>
                    <StatusBarItem>
                        <TextBlock Text="{Binding CursorY}" />
                    </StatusBarItem>
                </StatusBar>

                <Border Grid.Row="1" BorderBrush="#333" BorderThickness="0,1,0,0" Padding="8">
                    <DockPanel>
                        <TextBlock DockPanel.Dock="Top" Text="Log / Console" FontWeight="SemiBold" Margin="0,0,0,6" />
                        <TextBox Text="{Binding ConsoleText}"
                                 IsReadOnly="True"
                                 AcceptsReturn="True"
                                 TextWrapping="Wrap"
                                 VerticalScrollBarVisibility="Auto"
                                 HorizontalScrollBarVisibility="Auto" />
                    </DockPanel>
                </Border>
            </Grid>
        </Grid>
    </DockPanel>
</Window>
